webpackJsonp([0,8],{239:function(t,e,o){o(252);var i=o(0)(o(246),o(253),null,null);t.exports=i.exports},246:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{page:1,pageSize:10,author:{id:"",avatar_url:"",name:""},article:{title:"",content:"",create_at:"",good:!1,id:"",is_collect:!1,last_reply_at:"",tab:"",top:!1,visit_count:0},displayCommentList:[],comment:[],reply_count:0,popup:{replyId:null,show:!1,content:"",placeholder:"请在这里填写评论"},showExtBtnReply:!0}},activated:function(){this.page=1,this.onFetchDetail()},deactivated:function(){window.onscroll=null},methods:{onFetchDetail:function(){var t=this;this.$store.commit("SET_SHOWTABBAR",!1),this.author={id:"",avatar_url:"",name:""},this.article={title:"",content:"",create_at:"",good:!1,id:"",is_collect:!1,last_reply_at:"",tab:"",top:!1,visit_count:0},this.comment=[],this.reply_count=0,this.popup={replyId:null,show:!1,content:"",placeholder:"请在这里填写评论"},this.showExtBtnReply=!0;var e=this,o=document.documentElement.scrollTop||document.body.scrollTop;window.onscroll=function(){var t=document.documentElement.scrollTop||document.body.scrollTop;e.showExtBtnReply=o>=t,o=t;var i=document.body.scrollTop,s=document.body.scrollHeight,n=window.screen.availHeight,a=s-n-i;console.log(a),a<200&&e.onLoadMore()},this.$loading.show();var i=this.$route.query.id;this.$axios.get("https://cnodejs.org/api/v1/topic/"+i,{params:{accesstoken:this.$store.getters.accessToken}}).then(function(e){var o=e.data.data;t.author={id:o.author_id,name:o.author.loginname,avatar_url:o.author.avatar_url},t.article={title:o.title,content:o.content,create_at:o.create_at,good:o.good,id:o.id,is_collect:o.is_collect,last_reply_at:o.last_reply_at,tab:o.tab,top:o.top,visit_count:o.visit_count},t.comment=o.replies,t.reply_count=o.reply_count,t.displayCommentList=o.replies.slice(0,t.pageSize),t.$loading.hide()}).catch(function(e){console.log(e),t.$vux.toast.show({text:"获取数据失败"}),t.$loading.hide()})},checkLogin:function(){var t=this.$store.getters.accessToken;return!!t||(this.$vux.toast.show({text:"请先登录"}),this.$router.push("/login"),!1)},onReplyComment:function(t,e,o){this.checkLogin()&&(this.popup.replyId=t,this.popup.placeholder="正在回复"+(o+1)+"楼，"+e,this.popup.show=!0,console.log(this.$refs.input),this.$refs.input.onFocus())},onReplyArticle:function(){this.checkLogin()&&(this.popup.replyId=null,this.popup.placeholder="正在回复作者，"+this.author.name,this.popup.show=!0,console.log(this.$refs.input),this.$refs.input.onFocus())},onSendComment:function(){var t=this;this.checkLogin()&&(this.popup.content?(this.$loading.show(),this.$axios.post("/topic/"+this.article.id+"/replies",{accesstoken:this.$store.getters.accessToken,content:this.popup.content,reply_id:this.popup.replyId}).then(function(e){console.log(e),t.comment.push({author:{avatar_url:t.$store.getters.loginInfo.avatarUrl,loginname:t.$store.getters.loginInfo.loginname},content:t.popup.content,create_at:new Date,id:e.data.reply_id,reply_id:null,ups:[]}),t.popup.show=!1,t.$vux.toast.show({text:"评论成功"}),t.$loading.hide()}).catch(function(e){console.log(e),t.$vux.toast.show({text:"操作失败"}),t.$loading.hide()})):this.$vux.toast.show({text:"评论不能为空"}))},onLikeThisArticle:function(){var t=this;if(this.checkLogin()){var e=void 0,o=void 0;this.article.is_collect?(e="/topic_collect/de_collect",o="取消收藏成功"):(e="/topic_collect/collect",o="收藏成功"),this.$axios.post(e,{accesstoken:this.$store.getters.accessToken,topic_id:this.article.id}).then(function(e){console.log(e),t.article.is_collect=!t.article.is_collect,t.$vux.toast.show({text:o})}).catch(function(e){console.log(e),t.$vux.toast.show({text:"操作失败"})})}},onLikeThisComment:function(t,e){var o=this;this.checkLogin()&&this.$axios.post("/reply/"+t+"/ups",{accesstoken:this.$store.getters.accessToken}).then(function(t){var i=void 0;if("down"==t.data.action){i="取消点赞成功";var s=o.comment[e].ups.indexOf(o.$store.getters.loginInfo.id);o.comment[e].ups.splice(s,1)}else i="点赞成功",o.comment[e].ups.push(o.$store.getters.loginInfo.id);o.$vux.toast.show({text:i})}).catch(function(t){console.log(t),o.$vux.toast.show({text:"操作失败"})})},onLoadMore:function(){var t=this.page,e=this.pageSize,o=this.comment.slice(t*e,(t+1)*e);o.length&&(this.displayCommentList=this.displayCommentList.concat(o),this.page++)}},computed:{minHeight:function(){return document.body.clientHeight>=400&&document.body.clientHeight<=736?document.body.clientHeight:window.screen.height}}}},251:function(t,e,o){e=t.exports=o(237)(),e.push([t.i,"\n.weui_text_left .weui_input {\n  text-align: left;\n}\n","",{version:3,sources:["/./src/views/ArticleDetail.vue"],names:[],mappings:";AACA;EACE,iBAAiB;CAClB",file:"ArticleDetail.vue",sourcesContent:["\n.weui_text_left .weui_input {\n  text-align: left;\n}\n"],sourceRoot:"webpack://"}])},252:function(t,e,o){var i=o(251);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);o(244)("284449ac",i,!0)},253:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"article-box",style:{minHeight:t.minHeight+50+"px"}},[o("div",{staticClass:"head-box"},[o("h2",{staticClass:"head-title",domProps:{textContent:t._s(t.article.title)}}),t._v(" "),o("div",{staticClass:"head-intro"},[o("div",{staticClass:"avatar"},[o("img",{attrs:{src:t.author.avatar_url,alt:"headImgUrl"}})]),t._v(" "),o("div",{staticClass:"head-middle"},[o("div",{staticClass:"head-middle-top"},[o("div",{staticClass:"feed-label",class:[t.article.top?"feed-label-top":"feed-label-other"]},[t._v("\n            "+t._s(t._f("translateTab")(t.article.tab,t.article.top))+"\n          ")]),t._v(" "),o("span",{staticClass:"head-author-name",domProps:{textContent:t._s(t.author.name)}})]),t._v(" "),o("div",{staticClass:"head-middle-bottom"},[t._v("\n\n          "+t._s(t._f("timeAgo")(t.article.create_at))+"创建\n          ·\n          "),o("span",{domProps:{textContent:t._s(t.article.visit_count)}}),t._v("次预览\n          "),o("div",{staticClass:"icon-eye-open"})])]),t._v(" "),o("div",{staticClass:"head-right",on:{click:t.onLikeThisArticle}},[o("i",{class:[t.article.is_collect?"icon-heart":"icon-heart-empty"]})])])]),t._v(" "),o("div",{staticClass:"content-box markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),t._v(" "),o("div",{staticClass:"comment-box"},[o("div",{staticClass:"comment-title"},[t._v("\n      "+t._s(t.reply_count)+" 条回复\n    ")]),t._v(" "),t._l(t.displayCommentList,function(e,i){return o("div",{staticClass:"comment-li"},[o("div",{staticClass:"comment-head"},[o("router-link",{attrs:{to:{name:"user",query:{id:e.author.loginname}}}},[o("div",{staticClass:"avatar"},[o("img",{attrs:{src:e.author.avatar_url,alt:"headImgUrl"}})])]),t._v(" "),o("div",{staticClass:"comment-middle"},[o("div",{staticClass:"comment-middle-top",domProps:{textContent:t._s(e.author.loginname)}}),t._v(" "),o("div",{staticClass:"comment-middle-bottom"},[o("span",[t._v(t._s(i+1)+"楼")]),t._v(" · "+t._s(t._f("timeAgo")(e.create_at))+"\n          ")])]),t._v(" "),o("div",{staticClass:"comment-right"},[o("div",{class:{active:i<60&&e.ups.indexOf(t.$store.getters.loginInfo.id)>=0},staticStyle:{display:"flex"},on:{click:function(o){t.onLikeThisComment(e.id,i)}}},[o("i",{staticClass:"icon-thumbs-up"}),t._v(" "),o("span",{domProps:{textContent:t._s(e.ups.length)}})]),t._v(" "),o("i",{staticClass:"icon-reply",on:{click:function(o){t.onReplyComment(e.id,e.author.loginname,i)}}})])],1),t._v(" "),o("div",{staticClass:"comment-content markdown-body",domProps:{innerHTML:t._s(e.content)}})])})],2),t._v(" "),o("popup",{directives:[{name:"model",rawName:"v-model",value:t.popup.show,expression:"popup.show"}],domProps:{value:t.popup.show},on:{"on-hide":function(e){t.popup.show=!1},input:function(e){t.popup.show=e}}},[o("div",{staticClass:"popup-editor-box"},[o("x-input",{directives:[{name:"model",rawName:"v-model",value:t.popup.content,expression:"popup.content"}],ref:"input",staticClass:"weui_vcode weui_text_left",staticStyle:{"text-align":"left"},attrs:{placeholder:t.popup.placeholder},domProps:{value:t.popup.content},on:{input:function(e){t.popup.content=e}}},[o("x-button",{attrs:{type:"primary"},nativeOn:{click:function(e){t.onSendComment(e)}},slot:"right"},[t._v("发送")])],1)],1)]),t._v(" "),o("div",{staticClass:"ext-btn-reply",class:{hide:!t.showExtBtnReply},on:{click:t.onReplyArticle}},[o("i",{staticClass:"icon-reply"})])],1)},staticRenderFns:[]}}});
//# sourceMappingURL=0.499247ca7b7aa25374d0.js.map